<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Ginpeak • Touring Guide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Base styles (already in your project) -->
  <link rel="stylesheet" href="../css/base.css" />
  <link rel="stylesheet" href="../css/book.css" />
  <link rel="stylesheet" href="../css/map.css" />
  <link rel="stylesheet" href="../css/tour.css" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Safety net: ensure map has a height even if CSS doesn't apply -->
  <style>
    #map { height: 420px; width: 100%; border-radius: 12px; }
  </style>
</head>

<body>
  <main class="tour-wrap">

    <!-- Top navigation -->
    <nav class="tour-nav">
      <a href="../guide.html">← Back to guide</a>
      <a href="../tracks/Ginpeak_CAN_BC_Whistler_up.gpx" download class="btn">Download GPX</a>
    </nav>

    <!-- Header -->
    <header class="tour-header">
      <h1 class="tour-title">Ginpeak</h1>
      <p class="tour-sub">British Columbia • Whistler</p>
    </header>

    <!-- Map -->
    <section class="tour-map">
      <div id="map"></div>
    </section>

    <!-- Content -->
    <section class="tour-content">
      <p>&lt;!--</p>
<p>Template for: Ginpeak_CAN_BC_Whistler_up</p>
<p>This file will be auto-created if missing.</p>
<p>Write content only — metadata comes from tours.geojson.</p>
<p>--&gt;</p>
<h1>Overview</h1>
<p>TODO</p>
<h2>Quick facts</h2>
<ul>
<li><strong>Start / trailhead:</strong> TODO</li>
<li><strong>Best season:</strong> TODO</li>
<li><strong>Aspect / elevation band:</strong> TODO</li>
<li><strong>Typical time:</strong> TODO</li>
<li><strong>Typical distance / vert:</strong> TODO</li>
<li><strong>Group size / parking:</strong> TODO</li>
</ul>
<h1>Access</h1>
<p>TODO</p>
<h1>Route</h1>
<h2>Ascent</h2>
<p>TODO</p>
<h2>Descent</h2>
<p>TODO</p>
<h1>Avalanche terrain &amp; hazards</h1>
<ul>
<li><strong>Avalanche problems to watch:</strong> TODO</li>
<li><strong>Terrain traps:</strong> TODO</li>
<li><strong>Common “gotchas”:</strong> TODO</li>
<li><strong>Notes on safe options / bail-outs:</strong> TODO</li>
</ul>
<h1>Conditions &amp; timing</h1>
<ul>
<li>When the route is best (time of day, stability patterns, melt-freeze, etc.)</li>
<li>What makes it a “no-go”</li>
<li>Any micro-weather notes (wind loading zones, sun hits early, etc.)</li>
</ul>
<h1>Variants</h1>
<ul>
<li>Not outlined yet</li>
</ul>
<h1>Photos</h1>
<p>&gt; Add photos by dropping images into `docs/photos/Ginpeak_CAN_BC_Whistler_up/`.</p>
<p>Optional captions:</p>
<ul>
<li>`01.jpg` — TODO caption</li>
<li>`02.jpg` — TODO caption</li>
</ul>
<h1>References / links</h1>
<ul>
<li><a href="https://example.com">Link title</a></li>
<li><a href="https://avalanche.ca/">Avalanche Canada</a></li>
</ul>
<p>---</p>
<p><strong>Disclaimer:</strong> This is a personal route note, not a guarantee of safety. Always assess current conditions and consult the avalanche bulletin.</p>
    </section>

  </main>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Map boot: load per-tour detail GeoJSON (source of truth) -->
  <script>
    // Injected by your generator (filename stem / slug)
    const slug = "Ginpeak_CAN_BC_Whistler_up";

    // Tour pages live in: docs/tours/<slug>.html
    // Detail GeoJSON lives in: docs/data/tours_detail/<slug>.geojson
    const detailUrl = `../data/tours_detail/${slug}.geojson`;

    const map = L.map("map", { zoomControl: true });

    // --- Base layers ---
const openTopo = L.tileLayer(
  "https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",
  {
    maxZoom: 17,
    attribution: "&copy; OpenStreetMap contributors, SRTM | OpenTopoMap"
  }
);

const openStreet = L.tileLayer(
  "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
  {
    maxZoom: 19,
    attribution: "&copy; OpenStreetMap contributors"
  }
);

// --- Default basemap ---
openTopo.addTo(map);

// --- Layer control (top-right button) ---
L.control.layers(
  { "Topo": openTopo, "Street": openStreet },
  null,
  { collapsed: true }
).addTo(map);


    // Default fallback view (if fetch fails)
    map.setView([50.0, -123.0], 7);

    fetch(detailUrl)
      .then(r => {
        if (!r.ok) throw new Error(`Failed to load GeoJSON: ${detailUrl} (${r.status})`);
        return r.json();
      })
      .then(gj => {
        if (!gj || !gj.geometry || !Array.isArray(gj.geometry.coordinates)) {
          throw new Error("Detail GeoJSON missing geometry.coordinates");
        }

        // GeoJSON coords are [lon, lat, ele?]
        const coords = gj.geometry.coordinates;

        // Leaflet wants [lat, lon]
        const latlngs = coords.map(c => [c[1], c[0]]);

        if (latlngs.length < 2) {
          throw new Error("Not enough coordinates to draw a track");
        }

        const line = L.polyline(latlngs, {
          weight: 4,
          opacity: 0.9
        }).addTo(map);

        map.fitBounds(line.getBounds().pad(0.18));

        // Optional: start/end markers
        L.circleMarker(latlngs[0], { radius: 6, opacity: 1, fillOpacity: 0.9 })
          .addTo(map).bindTooltip("Start");

        L.circleMarker(latlngs[latlngs.length - 1], { radius: 6, opacity: 1, fillOpacity: 0.9 })
          .addTo(map).bindTooltip("End");
      })
      .catch(err => {
        console.error(err);
        // Keep fallback view
      });
  </script>
</body>
</html>
